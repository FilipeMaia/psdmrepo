<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>Experiment Registry Database</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

        <!-- Standard reset, fonts and grids -->
        <link rel="stylesheet" type="text/css" href="/yui/build/reset-fonts-grids/reset-fonts-grids.css">

        <!-- CSS for YUI -->
        <link rel="stylesheet" type="text/css" href="/yui/build/menu/assets/skins/sam/menu.css">
        <link rel="stylesheet" type="text/css" href="/yui/build/paginator/assets/skins/sam/paginator.css" />
        <link rel="stylesheet" type="text/css" href="/yui/build/datatable/assets/skins/sam/datatable.css" />
        <link rel="stylesheet" type="text/css" href="/yui/build/button/assets/skins/sam/button.css" />

        <!-- Custom CSS -->
        <link rel="stylesheet" type="text/css" href="RegDBTest.css" />

        <!-- Custom JavaScript -->
        <script type="text/javascript" src="Loader.js"></script>

        <!-- Page-specific styles -->
        <style type="text/css">
            div.yui-b p {
                margin: 0 0 .5em 0;
                color: #999;
            }
            div.yui-b p strong {
                font-weight: bold;
                color: #000;
            }
            div.yui-b p em {
                color: #000;
            }
            h1 {
                font-weight: bold;
                margin: 0 0 1em 0;
                padding: .25em .5em;
                background-color: #ccc;
            }
            #application_title {
                font-family: "Times", serif;
                font-size:42px;
                background-color:#d0d0d0;
                border:solid 2px transparent;
                border-left-width:16px;
            }
            #menubar {
                margin: 0 0 10px 0;
            }
            #context {
                margin-top:20px;
                margin-left:10px;
                margin-right:20px;
                margin-bottom:0px;
                /*font-family: "Serif", "Times New Roman";*/
                /*font-weight: bold;*/
                font-size:16px;
                /*color:#0071bc;*/
                /*background-color:#d0d0d0;*/
                border:solid 4px transparent;
                border-left-width:16px;
                text-align:left;
            }
            #workarea {
                margin-left:40px;
                margin-right:40px;
            }
            #experiment_info,
            #instrument_info {
                margin-top:0px;
                margin-left:4px;
            }
            #workarea_table_container          table,
            #experiment_params_table_container table,
            #instrument_params_table_container table {
                /*margin-left:auto;*/
                /*margin-right:auto;*/
            }
            #workarea_table_page,
            #experiment_params_table_page,
            #instrument_params_table_page {
                margin-left:auto;
                margin-right:auto;
            }
            #workarea_table_container,
            #workarea_table_container .yui-dt-loading,
            #experiment_params_table_container,
            #instrument_params_table_container,
            #experiment_params_table_container .yui-dt-loading,
            #instrument_params_table_container .yui-dt-loading {
                text-align:center;
                background-color:transparent;
            }
            #experiment_params_button_container,
            #instrument_params_button_container,
            #experiment_submit_button_container {
                margin-top:24px;
                margin-left:0px;
                text-align:left;
            }

        </style>

        <!-- Dependency source files -->
        <script type="text/javascript" src="/yui/build/yahoo-dom-event/yahoo-dom-event.js"></script>
        <script type="text/javascript" src="/yui/build/animation/animation.js"></script>
        <script type="text/javascript" src="/yui/build/container/container_core.js"></script>

        <!-- Menu source file -->
        <script type="text/javascript" src="/yui/build/menu/menu.js"></script>
        <script type="text/javascript" src="/yui/build/connection/connection-min.js"></script>
        <script type="text/javascript" src="/yui/build/json/json-min.js"></script>
        <script type="text/javascript" src="/yui/build/element/element-min.js"></script>
        <script type="text/javascript" src="/yui/build/paginator/paginator-min.js"></script>
        <script type="text/javascript" src="/yui/build/datasource/datasource-min.js"></script>
        <script type="text/javascript" src="/yui/build/datatable/datatable-min.js"></script>
        <script type="text/javascript" src="/yui/build/button/button-min.js"></script>

        <script type="text/javascript" src="/yui/build/yahoo/yahoo-min.js"></script>
        <script type="text/javascript" src="/yui/build/dom/dom-min.js"></script>


        <!-- Page-specific script -->
        <script type="text/javascript">

YAHOO.util.Event.onContentReady("menubar", function () {

    var oMenuBar = new YAHOO.widget.MenuBar("menubar", {
                                                autosubmenudisplay: true,
                                                hidedelay: 750,
                                                lazyload: true });
    var aSubmenuData = [
        { },
        {   id: "experiments",
            itemdata: [
                { text: "Select..", url: "javascript:list_experiments()" },
                { text: "Create New..", url: "javascript:javascript:create_experiment()" } ] },
        {   id: "instruments",
            itemdata: [
                { text: "Select..", url: "javascript:list_instruments()" },
                { text: "Create New..", url: "javascript:load('CreateInstrument.php','workarea')" } ] },
        { },
        {   id: "help",
            itemdata: [
                { text: "Help Menu...", url: "#" },
                { text: "About this application", url: "#" } ] } ];

    var ua = YAHOO.env.ua,
        oAnim;  // Animation instance

    function onSubmenuBeforeShow(p_sType, p_sArgs) {

        var oBody,
            oElement,
            oShadow,
            oUL;

        if (this.parent) {

            oElement = this.element;

            oShadow = oElement.lastChild;
            oShadow.style.height = "0px";

            if (oAnim && oAnim.isAnimated()) {
                oAnim.stop();
                oAnim = null;
            }
            oBody = this.body;

            //  Check if the menu is a submenu of a submenu.
            if (this.parent &&
                !(this.parent instanceof YAHOO.widget.MenuBarItem)) {

                if (ua.gecko || ua.opera) {
                    oBody.style.width = oBody.clientWidth + "px";
                }
                if (ua.ie == 7) {
                    oElement.style.width = oElement.clientWidth + "px";
                }
            }
            oBody.style.overflow = "hidden";

            oUL = oBody.getElementsByTagName("ul")[0];
            oUL.style.marginTop = ("-" + oUL.offsetHeight + "px");
        }
    }
    function onTween(p_sType, p_aArgs, p_oShadow) {

        if (this.cfg.getProperty("iframe")) {
            this.syncIframe();
        }
        if (p_oShadow) {
            p_oShadow.style.height = this.element.offsetHeight + "px";
        }
    }
    function onAnimationComplete(p_sType, p_aArgs, p_oShadow) {

        var oBody = this.body,
            oUL = oBody.getElementsByTagName("ul")[0];

        if (p_oShadow) {
            p_oShadow.style.height = this.element.offsetHeight + "px";
        }
        oUL.style.marginTop = "";
        oBody.style.overflow = "";

        //  Check if the menu is a submenu of a submenu.

        if (this.parent &&
            !(this.parent instanceof YAHOO.widget.MenuBarItem)) {

            // Clear widths set by the "beforeshow" event handler

            if (ua.gecko || ua.opera) {
                oBody.style.width = "";
            }
            if (ua.ie == 7) {
                this.element.style.width = "";
            }
        }
    }
    function onSubmenuShow(p_sType, p_sArgs) {

        var oElement,
            oShadow,
            oUL;

        if (this.parent) {

            oElement = this.element;
            oShadow = oElement.lastChild;
            oUL = this.body.getElementsByTagName("ul")[0];

            oAnim = new YAHOO.util.Anim(oUL,
                { marginTop: { to: 0 } },
                .5, YAHOO.util.Easing.easeOut);

            oAnim.onStart.subscribe(function () {
                oShadow.style.height = "100%";
            });
            oAnim.animate();

            if (YAHOO.env.ua.ie) {
                oShadow.style.height = oElement.offsetHeight + "px";
                oAnim.onTween.subscribe(onTween, oShadow, this);
            }
            oAnim.onComplete.subscribe(onAnimationComplete, oShadow, this);
        }
    }
    oMenuBar.subscribe("beforeRender", function () {

        var nSubmenus = aSubmenuData.length,
            i;

        if (this.getRoot() == this) {
            for (i = 0; i < nSubmenus; i++) {
                this.getItem(i).cfg.setProperty("submenu", aSubmenuData[i]);
            }
        }
    });
    oMenuBar.subscribe("beforeShow", onSubmenuBeforeShow);
    oMenuBar.subscribe("show", onSubmenuShow);
    oMenuBar.render();
});

function clear_div( id ) {
    document.getElementById(id).innerHTML='';
    document.getElementById('context').innerHTML='Home >';
}

/* The customizable object for encapsulating the context and
 * operations with tables.
 */
function Table( itsTableName, itsColumnDefs, itsDataRequest, hasPaginator ) {
    this.name = itsTableName;
    this.columnDefs = itsColumnDefs;
    this.fieldsDefs = [];
    for(i=0; i < itsColumnDefs.length; i++)
        this.fieldsDefs.push( itsColumnDefs[i].key );
    this.dataSource = new YAHOO.util.DataSource( itsDataRequest );
    this.dataSource.responseType = YAHOO.util.DataSource.TYPE_JSON;
    this.dataSource.connXhrMode = "queueRequests";
    this.dataSource.responseSchema = {
        resultsList: "ResultSet.Result",
        fields: this.fieldsDefs };
    this.paginator = null;
    if( hasPaginator )
        this.paginator = new YAHOO.widget.Paginator (
            {   containers : [this.name+"_table_page"],
                rowsPerPage: 10
            }
        );
    this.dataTable = new YAHOO.widget.DataTable(
        this.name+"_table",
        this.columnDefs,
        this.dataSource,
        { paginator: this.paginator/*new YAHOO.widget.Paginator( { rowsPerPage: 10 } )*/,
          initialRequest: "" } );

    this.refreshTable = function() {
        this.dataSource.sendRequest(
            "",
            { success: function() {
                  this.set( "sortedBy", null);
                  this.onDataReturnReplaceRows.apply( this, arguments );
              },
              failure: function() {
                  this.showTableMessage(
                      YAHOO.widget.DataTable.MSG_ERROR,
                      YAHOO.widget.DataTable.CLASS_ERROR );
                  this.onDataReturnAppendRows.apply( this, arguments );
              },
              scope: this.dataTable } ); };
}

function list_experiments() {

    document.getElementById('workarea').innerHTML=
        '<div id="workarea_table_container">'+
        '  <div id="workarea_table_page"></div>'+
        '  <div id="workarea_table"></div>'+
        '</div>';
    document.getElementById('context').innerHTML='<a href="javascript:clear_div(\'workarea\')">Home</a> > Select Experiment >';

    var table = new Table (
        "workarea",
        [ { key: "instrument",  sortable: true,  resizeable: true },
          { key: "experiment",  sortable: true,  resizeable: true },
          { key: "begin_time",  sortable: true,  resizeable: true },
          { key: "end_time",    sortable: true,  resizeable: true },
          { key: "description", sortable: false, resizeable: true } ],
        'RegDBRequestExperiments.php',
        true
    );
    table.refreshTable();
}

var experimentParamsShown = false;

function view_experiment( id, name ) {

    document.getElementById('workarea').innerHTML=
        '<div id="experiment_info"></div>'+
        '<br>'+
        '<div id="experiment_params_button_container">'+
        '  <button type="button" id="experiment_params_button" name="button1" value="Add">Parameters &gt;</button>'+
        '</div>'+
        '<br>'+
        '<div id="experiment_params">'+
        '  <div id="experiment_params_table_page"></div>'+
        '  <div id="experiment_params_table"></div>'+
        '</div>';
    document.getElementById('context').innerHTML=
        '<a href="javascript:clear_div(\'workarea\')">Home</a> > '+
        '<a href="javascript:list_experiments()">Select Experiment</a> > '+
        '<i>'+name+'</i>';
    load( 'DisplayExperiment_v1.php?id='+id, 'experiment_info' );

    experimentParamsShown = false;
    function onButtonClick( p_oEvent ) {
        if( experimentParamsShown ) {
            experimentParamsShown = false;
            document.getElementById('experiment_params').innerHTML=
                '  <div id="experiment_params_table_page"></div>'+
                '  <div id="experiment_params_table"></div>';
        } else {
            experimentParamsShown = true;
            var table = new Table (
                "experiment_params",
                [ { key: "name",        sortable: true,  resizeable: true },
                  { key: "value",       sortable: false, resizeable: true },
                  { key: "description", sortable: false, resizeable: true } ],
                'RegDBRequestExperimentParams.php?id='+id,
                false
            );
            table.refreshTable();
        }
    }
    var oPushButton1 = new YAHOO.widget.Button( "experiment_params_button" );
    oPushButton1.on(
        "click",
         onButtonClick );
}

function create_experiment( ) {

    document.getElementById('workarea').innerHTML=
        '<div id="experiment_info">'+
        '  <form name="myform" action="ProcessCreateExperiment.php" method="post">'+
        '    <div id="experiment_info_within_form"></div>'+
        '  </form>'+
        '</div>'+
        '<br>'+
        '<div id="experiment_submit_button_container">'+
        '  <button type="submit" id="experiment_submit_button" name="button2" value="Add">Submit</button>'+
        '</div>';
    document.getElementById('context').innerHTML=
        '<a href="javascript:clear_div(\'workarea\')">Home</a> > Create New Experiment > ';
    load( 'CreateExperiment_v1.php', 'experiment_info_within_form' );

    function onButtonClick( p_oEvent ) {
        alert( document.myform.action );
        document.myform.submit();
        //list_experiments();
    }
    var oPushButton2 = new YAHOO.widget.Button( "experiment_submit_button", { type: "submit", value: "experiment_submit_button_value" } );
    oPushButton2.on(
        "click",
         onButtonClick );
}

function list_instruments() {

    document.getElementById('workarea').innerHTML=
        '<div id="workarea_table_container">'+
        '  <div id="workarea_table_page"></div>'+
        '  <div id="workarea_table"></div>'+
        '</div>';
    document.getElementById('context').innerHTML='<a href="javascript:clear_div(\'workarea\')">Home</a> > Select Instrument >';

    var table = new Table (
        "workarea",
        [ { key: "instrument",  sortable: true,  resizeable: true },
          { key: "description", sortable: false, resizeable: true } ],
        'RegDBRequestInstruments.php',
        false
    );
    table.refreshTable();
}

var instrumentParamsShown = false;

function view_instrument( id, name ) {

    document.getElementById('workarea').innerHTML=
        '<div id="instrument_info"></div>'+
        '<br>'+
        '<div id="instrument_params_button_container">'+
        '  <button type="button" id="instrument_params_button" name="button1" value="Add">Parameters &gt;</button>'+
        '</div>'+
        '<br>'+
        '<div id="instrument_params">'+
        '  <div id="instrument_params_table_page"></div>'+
        '  <div id="instrument_params_table"></div>'+
        '</div>';
    document.getElementById('context').innerHTML=
        '<a href="javascript:clear_div(\'workarea\')">Home</a> > '+
        '<a href="javascript:list_instruments()">Select Instrument</a> > '+
        '<i>'+name+'</i>';
    load( 'DisplayInstrument_v1.php?id='+id, 'instrument_info' );

    instrumentParamsShown = false;
    function onButtonClick( p_oEvent ) {
        if( instrumentParamsShown ) {
            instrumentParamsShown = false;
            document.getElementById('instrument_params').innerHTML=
                '  <div id="instrument_params_table_page"></div>'+
                '  <div id="instrument_params_table"></div>';
        } else {
            instrumentParamsShown = true;
            var table = new Table (
                "instrument_params",
                [ { key: "name",        sortable: true,  resizeable: true },
                  { key: "value",       sortable: false, resizeable: true },
                  { key: "description", sortable: false, resizeable: true } ],
                'RegDBRequestInstrumentParams.php?id='+id,
                false
            );
            table.refreshTable();
        }
    }
    var oPushButton1 = new YAHOO.widget.Button( "instrument_params_button" );
    oPushButton1.on(
        "click",
         onButtonClick );
}

function list_groups() {

    document.getElementById('workarea').innerHTML=
        '<div id="workarea_table_container">'+
        '  <div id="workarea_table_page"></div>'+
        '  <div id="workarea_table"></div>'+
        '</div>';
    document.getElementById('context').innerHTML='<a href="javascript:clear_div(\'workarea\')">Home</a> > Select POSIX Group >';

    var table = new Table (
        "workarea",
        [ { key: "group",   sortable: true, resizeable: true },
          { key: "members", sortable: true, resizeable: true } ],
        'RegDBRequestGroups.php',
        false
    );
    table.refreshTable();
}

function view_group( name ) {

    document.getElementById('workarea').innerHTML=
        '<div id="workarea_table_container">'+
        '  <div id="workarea_table_page"></div>'+
        '  <div id="workarea_table"></div>'+
        '</div>';
    document.getElementById('context').innerHTML=
        '<a href="javascript:clear_div(\'workarea\')">Home</a> > '+
        '<a href="javascript:list_groups()">Select POSIX Group</a> > '+
        '<i>'+name+'</i>';

    var table = new Table (
        "workarea",
        [ { key: "uid",   sortable: true, resizeable: true },
          { key: "name",  sortable: true, resizeable: true },
          { key: "email", sortable: true, resizeable: true } ],
        'RegDBRequestGroupMembers.php?name='+name,
        false
    );
    table.refreshTable();
}
        </script>

    </head>
    <body class="yui-skin-sam" id="body">
        <div id="application_title">
            <p>Experiment Registry Database</p>
            <p style="font-size:32px;"><i>AJAX Version</i></p>
        </div>
        <div id="menubar" class="yuimenubar yuimenubarnav">
            <div class="bd">
                <ul class="first-of-type">
                    <li class="yuimenubaritem first-of-type">
                        <a class="yuimenubaritemlabel" href="javascript:clear_div('workarea')">Home</a>
                    </li>
                    <li class="yuimenubaritem">
                        <a class="yuimenubaritemlabel" href="#experiments">Experiments</a>
                    </li>
                    <li class="yuimenubaritem">
                        <a class="yuimenubaritemlabel" href="#instruments">Instruments</a>
                    </li>
                    <li class="yuimenubaritem">
                        <a class="yuimenubaritemlabel" href="javascript:list_groups()">POSIX Groups</a>
                    </li>
                    <li class="yuimenubaritem">
                        <a class="yuimenubaritemlabel" href="#">Help</a>
                    </li>
                </ul>
            </div>
        </div>
        <p id="context">Home > </p>
        <br>
        <div id="workarea"></div>
        <br>
        <br>
        <div id="application_footer">
            <center>2009 <a href="http://www.slac.stanford.edu">SLAC National Accelerator Laboratory</a></center>
        </div>
    </body>
</html>