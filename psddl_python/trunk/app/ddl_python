#!/bin/sh

if [ ! -d psddldata/data/ ]; then
    echo "The psddldata/data directory was not found. Try doing 'addpkg psddldata' first."
    exit 1
fi

echo > psana_python/src/devicetypes.py "# Do not edit this file; it is automatically generated by psana_python/app/ddl_python."
echo >> psana_python/src/devicetypes.py ""
echo >> psana_python/src/devicetypes.py "class DeviceType:"
echo >> psana_python/src/devicetypes.py "    pass"

echo "" > psana_python/src/WrapperList.txt
for f in  psddldata/data/*.ddl.xml ; do
  module=`basename $f .ddl.xml`
  if [ "$module" == "xtc" ] ; then
      continue
  fi
  package=`grep "package name" $f | sed -e 's,^.*name=",,' -e 's,".*,,'`
  echo "DECL($package)" >> psana_python/src/WrapperList.txt
  echo "module $module, package $package"
  psddlc -b python -I data -I psddl_psana --t Psana -e psddl_python/include/$module.ddl.wrapper.h -o psddl_python/src/$module.ddl.wrapper.cpp psddldata/data/$module.ddl.xml
done
